<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

	<title>Facile Core Source: core/index.ts</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	
	<link type="text/css" rel="stylesheet" href="styles/site.cerulean.css">
	
	<style>
		.sideMenu
		{
			margin-left: 320px!important;

		}
		#main
		{
			margin-top: 46px;
		}
		#mainMenu
		{
			position: fixed;
			left: 0px;
			top: 0px;
			
		}

		#searchBox
		{
			vertical-align: none !important;
			padding-right: 0px;
			width:238px;

		}
		.sideMargin
		{
			margin-left: 15px;
		}
		.sunlight-code-container
		{
			border:none!important;
		}
		.navTitle
		{
			font-size:15px;
			padding:0px;

		}
		.nav-list
		{
			width: 100%;
		}
		.nav-list
		{
			padding-left:20px;
		}		
		.nav-list li
		{
			line-height: 16px;
		}
		.handCursor
		{
			cursor: pointer;
		}
		.nav-pills > li > a {
			padding-top: 0px;
			padding-bottom: 0px;
		}

		#projectTitle
		{
			position: fixed;
			padding-left: 10px;
			padding-top: 5px;
			font-size: 26px;
			font-weight: lighter;
			letter-spacing: -1px;
			background-color: #FFF;
			width: 100%;
			height: 35px;
			line-height: 18px;
			color: #000;
			border-bottom: 1px solid rgba(0,0,0,.2);
			z-index: 10;
		}
		h1, h2, h3, h4, h5, h6 {
			font-family: 'Helvetica Neue';
			font-weight: lighter;
		}
		h3
		{
			font-size: 22px;
			font-weight: lighter;
		}
		.page-title
		{
			font-weight: lighter;
			font-size: 28px;
			letter-spacing: -2px;
			padding-top:0px;
		}

		.well
		{
			padding: 5px;
			width:280px;
			margin-left:0px;
		}


		.menuFrame
		{
			margin-top: 20px;
			overflow:hidden; 
			overflow-y:auto;
		}
		.menuFrame::-webkit-scrollbar {
		    -webkit-appearance: none;
		}

		.menuFrame::-webkit-scrollbar:vertical {
		    width: 11px;
		}

		.menuFrame::-webkit-scrollbar:horizontal {
		    height: 11px;
		}

		.menuFrame::-webkit-scrollbar-thumb {
		    border-radius: 8px;
		    border: 2px solid white; /* should match background, can't be transparent */
		    background-color: rgba(0, 0, 0, .5);
		}
		
		.container-fluid
		{
			padding-left: 10px;
		}

		#side-menu
		{
			height: 415px;
			box-shadow: inset 0 0 10px rgba(0,0,0,.5);
			border: 1px solid #999;
		}

		#menuAside
		{
			margin-top:50px;
			position:fixed;
		}

		.member {
			font-size: 14px;
			color:#000;
			background-color:#FFF;
			border:1px solid #2fa4e7;
		}
		.member:hover {

			background-color:#F6F6F6;
		}		
		.member-open .paramSignature{
			font-size: 14px;
			color: #2fa4e7;
		}
		.member-collapsed .paramSignature{
			font-size: 14px;
			color: #2fa4e7;
		}
		.routeTitle{
		    cursor: pointer;
		}

		.genericAnnotation
		{
		    color:#2fa4e7;
		}

		.sourceBar
		{
			margin-top: -5px;
		}



.twitter-typeahead
{
	top: -5px;
}
.twitter-typeahead .tt-query,
.twitter-typeahead .tt-hint {
  margin-bottom: 0;
  background-color: #F00;
  border-radius: 20px;

}

.tt-hint
{
	top: 2px!important;

    padding-left: 10px!important;  
    width: 188px;
    text-indent: 4px;
}
.tt-dropdown-menu {
  min-width: 160px;
  margin-top: 2px;
  padding: 5px 0;
  background-color: #fff;
  border: 1px solid #ccc;
  border: 1px solid rgba(0,0,0,.2);
  *border-right-width: 2px;
  *border-bottom-width: 2px;
  -webkit-border-radius: 6px;
     -moz-border-radius: 6px;
          border-radius: 6px;
  -webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);
     -moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);
          box-shadow: 0 5px 10px rgba(0,0,0,.2);
  -webkit-background-clip: padding-box;
     -moz-background-clip: padding;
          background-clip: padding-box;
}

.tt-suggestion {
  display: block;
  padding: 3px 20px;
}

.tt-suggestion.tt-is-under-cursor {
  color: #fff;
  background-color: #0081c2;
  background-image: -moz-linear-gradient(top, #0088cc, #0077b3);
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#0088cc), to(#0077b3));
  background-image: -webkit-linear-gradient(top, #0088cc, #0077b3);
  background-image: -o-linear-gradient(top, #0088cc, #0077b3);
  background-image: linear-gradient(to bottom, #0088cc, #0077b3);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff0088cc', endColorstr='#ff0077b3', GradientType=0)
}

.tt-suggestion.tt-is-under-cursor a {
  color: #fff;
}

.tt-suggestion p {
  margin: 0;
}

	</style>
</head>

<body>
<div id="projectTitle">
	<div id="btnCollapse" class="btn collapseSidebarButton btn-primary"><i class="icon-th-list icon-white"></i></div>
	Facile Core
</div>	
<div class="container-fluid">

	<div id="menuAside">
    <aside class="well span3 oc" id="side-menu" role="navigation">

    	<div style="margin-left: 10px; margin-top: 10px;">
			<input type="text" id="searchBox" class="search-query typeahead" placeholder="Search">
		</div>
		<div class="menuFrame" id="sideMenuFrame">
		<ul id="menuContainer" class="nav nav-pills nav-stacked">
			<li class="nav-header navTitle"><a href="index.html">INDEX</a></li>
				<li class="divider"></li>
				
				
					    <li id="navTitle_Classes" class="nav-header navTitle">
                            <a class="handCursor" data-toggle="collapse" data-id="T_Classes" data-target="#collapse_Classes">Classes<span class="badge badge-info pull-right">7</span></a>
                        </li>
                        <li id="navContents_Classes">
                            <div id="collapse_Classes" class="collapse">
                                <ul class="nav nav-list" style="width:100%;margin-left:-8px;">
                                    <li><a href="Collection.html">Collection</a></li><li><a href="Controller.html">Controller</a></li><li><a href="Core.html">Core</a></li><li><a href="Facile.html">Facile</a></li><li><a href="Filter.html">Filter</a></li><li><a href="Model.html">Model</a></li><li><a href="Service.html">Service</a></li>
                            
                                    </ul>
                                </div>
                            </li>
                        

		</ul>
		</div>

		<script>
			var searchMembers = [{"realName":"Collection","link":"Collection"},{"realName":"Controller","link":"Controller"},{"realName":"Core","link":"Core"},{"realName":"Facile","link":"Facile"},{"realName":"Filter","link":"Filter"},{"realName":"Model","link":"Model"},{"realName":"Service","link":"Service"}];
		</script>
    </aside>
	</div>
    <div id="docContents" class="sideMenu sideMargin">

		
			<div style="width:100%">
		
				<div id="main">
					


		<h1 class="page-title">Source: core/index.ts</h1>
    
    <section>
        <article>
            <pre class="sunlight-highlight-javascript ">
// External Dependencies.
import * as vscode from 'vscode';
import { resolve, join } from 'path';
import * as express from 'express';
import * as Boom from 'boom';
import { series as asyncSeries } from 'async';
import { LoggerInstance, Logger, transports, TransportInstance } from 'winston';
import { wrap, create, badRequest, unauthorized, forbidden, notFound, notImplemented } from 'boom';
import { Server, Socket } from 'net';
import { readFileSync } from 'fs';
import { extend as _extend, isPlainObject, each, isFunction,
				isString, maxBy, has, isBoolean, bind, values } from 'lodash';
import { red, cyan } from 'chalk';

// Internal Dependencies.
import * as utils from './utils';
import { Core } from './core';
import * as defaults from './defaults';
import { IFacile, ICertificate, IConfig, IRouters, IRoute,
				IBoom, ICallbackResult, IFilter,
				IMiddleware, ISockets, IModel, IController,
				IUtils, IConfigs, IRequestHandler, IRoutes, IService,
				IViewConfig, IInit, ICallback, IMiddlewares, IComponents,
				IComponent, IErrorRequestHandler, IPolicies } from '../interfaces';
import { Collection } from './collection';

import * as server from './server';
import * as services from './services';
import * as filters from './filters';
import * as models from './models';
import * as controllers from './controllers';
import * as routes from './routes';

// Get Facile and App packages.
let packages = defaults.packages;

/**
 * Facile Core
 *
 * @export
 * @class Facile
 * @extends {Events}
 * @implements {IFacile}
 */
export class Facile extends Core implements IFacile {

	/**
	 * Singleton instance of Facile
	 *
	 * @static
	 * @member {Facile} Facile.staticProperty
	 * @memberOf Facile
	 */
	static instance: Facile;

	/**
	 * Facile constructor.
	 * @constructor
	 * @memberof Facile
	 */
	constructor () {

		// Extend class with emitter.
		super();

		if (Facile.instance)
			return Facile.instance;

		// Set Facile's package.json to variable.
		this._pkg = packages.pkg;

		// set the app's package.json.
		this._apppkg = packages.apppkg;

		// Create the default logger.
		// This will likely be overwritten.
		let defaultLogger = new Logger({
			level: 'info',
			transports: [
				new (transports.Console)({
					colorize: true,
					handleExceptions: true,
					humanReadableUnhandledException: true
				})
			]
		});

		// Add default logger to map 
		// and set as "log" instance.
		this.logger = defaultLogger;

		// Create Express app.
		this.express = express;
		this.app = express();
		this._initialized = false;
		this._started = false;

		// support v5.x see app.router instead of app._router.
		this._routers['default'] = this.app.router || this.app._router;

		// Set the instance.
		Facile.instance = this;

		return this;

	}

	///////////////////////////////////////////////////
	// PRIVATE METHODS
	///////////////////////////////////////////////////

	/**
	 * Enables Lifecycle Listeners.
	 *
	 * Events
	 *
	 * init
	 * init:server
	 * init:services
	 * init:filters
	 * init:models
	 * init:controllers
	 * init:routes
	 * init:done
	 * core:start
	 *
	 * @private
	 * @method _enableListeners
	 * @returns {Facile}
	 * @memberOf Facile
	 */
	private _enableListeners(): Facile {

		let init = this.init();

		this.on('init', init.run);

		this.on('init:server', init.server);

		this.on('init:services', init.services);

		this.on('init:filters', init.filters);

		this.on('init:models', init.models);

		this.on('init:controllers', init.controllers);

		this.on('init:routes', init.routes);

		this.on('init:done', init.done);

		this.on('core:start', this.start);

		this.on('core:listen', this._listen);

		// Set flag indicating that
		// init hooks are listening
		// in case called manually.
		this._config.auto = true;

		return this;

	}

	/**
	 * Start Listening for Connections
	 *
	 * @private
	 * @method _listen
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	private _listen(): void {

		if (!this._started) {
			this.logger.error('Facile.listen() cannot be called directly please use .start().');
			process.exit();
		}

		// Listen for connections.
		this.logger.debug('Server preparing to listen.');

		this.server.listen(this._config.port, this._config.host, (err: Error) => {
			if (err)
				throw err;
		});

	}

	///////////////////////////////////////////////////
	// CONFIGURE &amp; MANAGE SERVER
	///////////////////////////////////////////////////

  /**
   * Configure
	 *
   * @method configure
   * @param {(string | IConfig)} [config]
   * @returns {Facile}
   * @memberOf Facile
   */
	configure(config?: string | IConfig): Facile {

		// Check if configuration is string.
		// If yes try to load the config.
		if (isString(config))
			config = this.config(config);

		// Extend options with defaults.
		this._config = _extend({}, defaults.config, config);

		// Setup the Logger.
		if (this._config.logger)
			this.logger = this._config.logger;

		// If log level was set Iterate
		// transports and set level.
		if (this._config.logLevel)
			each(this.logger.transports, (t: any) => {
				t.level = this._config.logLevel;
			});

		this.logger.debug('Defining Boom error handlers.');

		// Expose common Boom events to framework.
		this.Boom = {
			wrap: Boom.wrap,
			create: Boom.create,
			badRequest: Boom.badRequest,
			unauthorized: Boom.unauthorized,
			forbidden: Boom.forbidden,
			notFound: Boom.notFound,
			notImplemented: Boom.notImplemented,
			badGateway: Boom.badGateway
		};

		this.logger.debug('Defining node environment.');

		// Ensure environment.
		this._config.env = this._config.env || 'development';

		// Set Node environment.
		process.env.NODE_ENV = this._config.env;

		// Ensure config auto has value.
		this._config.auto = this._config.auto !== false ? true : false;

		this._configured = true;

		return this;

	}

	/**
	 * Returns Initialization Methods
	 *
	 * @method init
	 * @returns {IInit}
	 * @memberOf Facile
	 */
	init(): IInit {

		let facile: Facile = this;

		// Ensure configuration.
		if (!this._config) {
			this.logger.warn('Failed to initialize please run facile.configure()...exiting.');
			process.exit();
		}

		if (this._config.auto &amp;&amp; !this._autoInit) {
			console.log('');
			this.logger.error('Facile config set to "auto" but attempted to init manually.');
			process.exit();
		}

		/**
		 * Used internally to trigger
		 * init events after configuration.
		 *
		 * @private
		 * @method run
		 * @returns {IInit}
		 * @memberOf Facile
		 */
		function run(): void {

			if (!facile._config.auto) {
				this.logger.error('The method init().run() cannot be called manually use { auto: true } in your configuration.');
				process.exit();
			}

			facile.execBefore('init', () => {
				facile.emit('init:server');
			});

		}

		/**
		 * Used internally to trigger
		 * init done event.
		 *
		 * @member done
		 * @private
		 * @returns {Facile}
		 * @memberOf Facile
		 */
		function done(): Facile {

			facile.logger.debug('Facile initialization complete.');

			facile._initialized = true;

			if (facile._config.auto) {

				facile.execAfter('init', () => {
					facile.emit('core:start');
				});

			}

			else {

				return facile;

			}

		}

		let inits: IInit = {

			// run: 					run.bind(that),
			// server: 				server.init.bind(that),
			// services: 			services.init.bind(that),
			// filters: 			filters.init.bind(that),
			// models: 				models.init.bind(that),
			// controllers: 	controllers.init.bind(that),
			// routes: 				routes.init.bind(that),
			// done: 					done.bind(that)

			run: 						run,
			server: 				server.init(facile),
			services: 			services.init(facile),
			filters: 				filters.init(facile),
			models: 				models.init(facile),
			controllers: 		controllers.init(facile),
			routes: 				routes.init(facile),
			done: 					done

		};

		return inits;

	}

	/**
	 * Start Server.
	 *
	 * @method start
	 * @param {Function} [fn]
	 * @method
	 * @memberof Facile
	 */
	start(config?: string | IConfig | Function, fn?: Function): Facile {

		// Allow callback as first argument.
		if (isFunction(config)) {
			fn = config;
			config = undefined;
		}

		/////////////////////////////
		// Wait/Start Facile
		/////////////////////////////

		function handleStart(): void {

			// On listening Handle Callback.
			this.server.on('listening', () => {

				let address = this.server.address(),
						addy = address.address,
						port = address.port;

				if (this._config.auto)
					this.execAfter('core:listen');

				// Call if callack function provided.
				if (fn)
					fn(this);

				console.log(cyan('\nServer listening at: http://' + addy + ':' + port));

			});

			if (this._config.auto) {
				this.execAfter('core:start', () => {
					this._started = true;
					this.emit('core:listen');
				});
			}
			else {
				this._started = true;
				this.listen();
			}

		}

		let waitId;

		/**
		 * Waits to start server until initialized.
		 * This is only used when "auto" is NOT set
		 * to true in your config.
		 */
		function handleWaitStart(): void {
			if (!this._initialized) {
				waitId = setTimeout(handleWaitStart.bind(this), 10);
			}
			else {
				clearTimeout(waitId);
				handleStart.call(this);
			}
		}

		/////////////////////////////
		// Ensure Configuration
		/////////////////////////////

		if (!this._configured)
			this.configure(config);

		// Can't continue without configuration.
		// Should never hit but just in case.
		if (!this._config) {
			console.log('');
			this.logger.error('Failed to start Facile missing or invalid configuration.');
			process.exit();
		}

		/////////////////////////////
		// Manual or Auto Init
		/////////////////////////////

		if (this._config.auto) {

			this.logger.debug('Auto configuration detected.');

			// Initialize first which will round
			// trip and call start again falling
			// through to the execution below.
			if (!this._initialized) {

				// ensures manual init is not called while auto is set.
				this._autoInit = true;

				this._enableListeners();
				this.init().run();

			}

			// Facile now initalized can now start.
			else {

				this.execBefore('core:start', () => {
					handleStart.call(this);
				});

				return this;

			}

		}
		else {

			// When starting manually must have
			// called configure and init manually
			// before starting.
			if (!this._initialized) {
				console.log('');
				this.logger.error('Facile failed to start call facile.init() before starting.');
				process.exit();
			}

			handleWaitStart.call(this);

			// Don't wait just return.
			return this;

		}

	}

	/**
	 * Stops the server.
	 *
	 * @method stop
	 * @param {string} [msg]
	 * @param {number} [code]
	 * @returns {void}
	 *
	 * @memberOf Facile
	 */
	stop(msg?: string, code?: number): void {

		if (!this.server) {
			return;
		}

		// Closing sockets.
		let socketKeys = Object.keys(this._sockets);
		this.logger.debug('Closing active (' + socketKeys.length + ') socket connections.');

		socketKeys.forEach((id) => {
			let socket = this._sockets[id];
			if (socket)
				socket.destroy();
		});

		// Close the server.
		this.logger.debug('Closing server.');
		this.server.close(() => {
			console.log(cyan('\nServer successfully closed.'));
		});

	}

	///////////////////////////////////////////////////
	// REGISTERING RESOURCES
	///////////////////////////////////////////////////

	/**
	 * registerConfig
	 *
	 * @method registerConfig
	 * @param {string} name
	 * @param {...any[]} extend
	 *
	 * @memberOf Facile
	 */
	registerConfig(name: string, ...extend: any[]): Facile

	/**
	 * registerConfig
	 *
	 * @method registerConfig
	 * @param {IConfigs} configs
	 * @param {...any[]} extend
	 *
	 * @memberOf Facile
	 */
	registerConfig(configs: IConfigs, ...extend: any[]): Facile;

	registerConfig(name: string | IConfigs, ...extend: any[]): Facile {

		let self = this;
		let _configs: IConfig[] = [];

		function normalizeConfigs(arr, reset) {
			if (reset)
				_configs = [{}];
			arr.forEach((c) => {
				if (isString(c))
					_configs.push(self.config(c) || {});
				else if (isPlainObject(c))
					_configs.push(c);
			});
		}

		if (isPlainObject(name)) {
			each(name, (v, k) => {
				normalizeConfigs(extend, true);
				_configs.push(v);
				this._configs[k] = _extend.apply(null, _configs);
			});
		}

		else {

			normalizeConfigs(extend, true);
			this._configs[name as string] = _extend.apply(null, _configs);

		}

		return this;

	}

	/**
	 * registerMiddleware
	 *
	 * @method registerMiddleware
	 * @param {IMiddlewares} middlewares
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerMiddleware(middlewares: IMiddlewares): Facile;

	/**
	 * registerMiddleware
	 *
	 * @method registerMiddleware
	 * @param {string} name
	 * @param {IRequestHandler} fn
	 * @param {number} [order]
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerMiddleware(name: string, fn: IRequestHandler, order?: number): Facile;

	/**
	 * registerMiddleware
	 *
	 * @method registerMiddleware
	 * @param {string} name
	 * @param {IErrorRequestHandler} fn
	 * @param {number} [order]
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerMiddleware(name: string, fn: IErrorRequestHandler, order?: number): Facile;

	registerMiddleware(name: string | IMiddlewares, fn?: IRequestHandler | IErrorRequestHandler, order?: number): Facile {

		let middlewares: any = {};

		// Adding single middleware.
		if (isString(name))
			middlewares[name] = {
				fn: fn,
				order: order
			};

		// Adding map of middleware.
		else
			middlewares = name;

		// Iterate the map ensure order.
		each(middlewares, (v, k) => {

			// No order generate.
			if (v.order === undefined) {
				let max = utils.maxIn(this._middlewares, 'order') || 0;
				v.order = max;
				if (max > 0)
					v.order += 1;
			}
			// Use specified order
			// check if exists, if true
			// update with decimal until
			// value doesn't exist.
			else {
				let tmpOrder = v.order;
				// Prevents two middlewares with
				// same order value.
				while (utils.hasIn(this._middlewares, 'order', tmpOrder)) {
					tmpOrder += .1;
				}
				v.order = tmpOrder;
			}

			// Update the middlewares object.
			this._middlewares[k] = v;

		});

		return this;

	}

	/**
	 * registerRoute
	 *
	 * @method registerRoute
	 * @param {IRoutes} routes
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerRoute(routes: IRoutes): Facile;

	/**
	 * registerRoute
	 *
	 * @method registerRoute
	 * @param {Array&lt;IRoute>} routes
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerRoute(routes: Array&lt;IRoute>): Facile;

	registerRoute(route: IRoute | IRoutes | IRoute[]): Facile {

		let self = this;

		// Helper function to validate
		// the route and log if invalid.
		function validate(_route: IRoute) {

			// Validate the route.
			_route = utils.validateRoute(_route);

			// Push the route to the collection
			// if is valid.
			if (_route.valid)
				self._routes.push(_route);

			// Otherwise log a warning.
			else
				self.logger.warn(`Failed to add route "${_route.url}", the configuration is invalid.`, route);

		}

		// Handle array of route objects.
		if (Array.isArray(route)) {
			let routes = route as Array&lt;IRoute>;
			routes.forEach((r) => {
				validate(r);
			});
		}

		// Handle Routes map.
		else if (isPlainObject(route)) {
			let routes = route as IRoutes;
			each(routes, (v, k) => {
				let rte = utils.parseRoute(k, v);
				validate(rte);
			});
		}

		else {
			validate(route);
		}

		return this;

	}

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {IPolicies} policies
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: IPolicies): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {boolean} filter
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, policy: boolean): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {string} filter
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, policy: string): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {string[]} filter
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, policy: string[]): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {IRequestHandler} filter
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, policy: IRequestHandler): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {Array&lt;IRequestHandler>} filter
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, policy: Array&lt;IRequestHandler>): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {IPolicies} policy
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, policy: IPolicies): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {string} action
	 * @param {boolean} policy
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, action: string, policy: boolean): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 *
	 * @param {string} name
	 * @param {string} action
	 * @param {string} policy
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, action: string, policy: string): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {string} action
	 * @param {string[]} policy
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, action: string, policy: string[]): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {string} action
	 * @param {IRequestHandler} policy
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, action: string, policy: IRequestHandler): Facile;

	/**
	 * registerPolicy
	 *
	 * @method registerPolicy
	 * @param {string} name
	 * @param {string} action
	 * @param {Array&lt;IRequestHandler>} policy
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerPolicy(name: string, action: string, policy: Array&lt;IRequestHandler>): Facile;

	registerPolicy(name: string | IPolicies,
								action?: string | boolean | string[] | IRequestHandler | Array&lt;IRequestHandler> | IPolicies,
								policy?: string | boolean | string[] | IRequestHandler | Array&lt;IRequestHandler>): Facile {

		let self = this;

		function isValidParent(key, val) {
			if (key !== '*' &amp;&amp; !isPlainObject(val)) {
				self.logger.warn('Invalid parent policy key "' + key + '" ignored, parent policy values must be objects execpt global policy key.');
				return false;
			}
			else if (key === '*' &amp;&amp; (!isString(val) &amp;&amp; !Array.isArray(val)) || isPlainObject(val)) {
				self.logger.warn('Invalid global policy key ignored, only boolean, strings, arrays of string or arrays of functions are supported.');
				return false;
			}
			return true;
		}

		// Adding policy with action plicy.
		if (arguments.length === 3) {

			let _name = name as string;
			let _action;
			this._policies[_name] = this._policies[_name] || {};
			this._policies[_name][_action] = policy;

		}

		// Adding map of policies.
		else if (isPlainObject(name)) {

			Object.keys(name).forEach((key) => {

				let val = Object[key];
				this._policies[key] = this._policies[key] || {};

				if (isValidParent(key, val)) {
					if (key === '*')
						this._policies[key] = val;
					else
						_extend(this._policies[key], val);
				}

			});

		}

		// Adding single policy.
		else {

			let _name = name as string;
			this._policies[_name] = this._policies[_name] || {};
			if (isValidParent(name, action)) {
				_extend(this._policies[_name], action);
			}

		}

		return this;

	}

	/**
	 * registerComponent
	 *
	 * @method registerComponent
	 * @param {IComponent} Component
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerComponent(Component: IComponent): Facile;

	/**
	 * registerComponent
	 *
	 * @method registerComponent
	 *
	 * @param {IComponents} components
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerComponent(components: IComponents): Facile;

	/**
	 * registerComponent
	 *
	 * @method registerComponent
	 *
	 * @param {string} name
	 * @param {IComponent} Component
	 * @returns {Facile}
	 *
	 * @memberOf Facile
	 */
	registerComponent(name: string, Component: IComponent): Facile;

	registerComponent(name: string | IComponent | IComponents, Component?: IComponent): Facile {

		let self = this;
		let Comp: any;

		function registerFailed(type) {
				self.logger.error('Failed to register using unsupported type "' + type + '".');
				process.exit();
		}

		function registerByType(type) {

			let collection;

			if (type === 'Service')
				collection = self._services as Collection&lt;IService>;
			else if (type === 'Filter')
				collection = self._filters as Collection&lt;IFilter>;
			else if (type === 'Controller')
				collection = self._controllers as Collection&lt;IController>;
			else if (type === 'Model')
				collection = self._models as Collection&lt;IModel>;
			else
				registerFailed(typeof type);

			// If not type try to get name
			// from function/class name.
			if (isFunction(name)) {
				Component = name;
				name = utils.constructorName(name);
			}

			// Adding single component by name and class/function.
			if (isString(name)) {
				collection.add(name, Component);
			}

			// Otherwise iterate object.
			else if (isPlainObject(name)) {
				each(name, (v, k) => {
					collection.add(k, v);
				});
			}

			// Otherwise log error.
			else {
				let failedType = typeof Component || typeof name;
				self.logger.error('Failed ot register component using unsupported type "' +
													failedType + ' ".');
			}

			return self;

		}

		// Get the Component Type
		// before attempting to register.
		if (Component)
			Comp = Component;
		else if (isPlainObject(name))
			Comp = values(name)[0];
		else if (isFunction(name))
			Comp = name;
		else
			registerFailed(typeof Component || typeof name);

		return registerByType(Comp.type);


	}

	///////////////////////////////////////////////////
	// INSTANCE HELPERS
	///////////////////////////////////////////////////

	/**
	 * router
	 *
	 * @desc gets or creates a router.
	 * @method router
	 * @param {string} name
	 * @returns {express.Router}
	 *
	 * @memberOf Facile
	 */
	router(name: string, options?: any): express.Router {
		if (!this._routers[name])
			this._routers[name] = express.Router(options);
		return this._routers[name];
	}

	/**
	 * Gets a Config by name.
	 *
	 * @method config
	 * @param {string} name
	 * @returns {IConfig}
	 *
	 * @memberOf Facile
	 */
	config(name: string): IConfig {
		return this._configs[name];
	}

	/**
	 * Gets a Service
	 *
	 * @method service
	 * @template T
	 * @param {string} name
	 * @returns {T}
	 *
	 * @memberOf Facile
	 */
	service&lt;T>(name: string): T {
		let component: T = this._services[name];
		return component;
	}

	/**
	 * Gets a Filter
	 *
	 * @method filter
	 * @template T
	 * @param {string} name
	 * @returns {T}
	 *
	 * @memberOf Facile
	 */
	filter&lt;T>(name: string): T {
		let component: T = this._filters[name];
		return component;
	}

	/**
	 * Gets a Model
	 *
	 * @method model
	 * @template T
	 * @param {string} name
	 * @returns {T}
	 *
	 * @memberOf Facile
	 */
	model&lt;T>(name: string): T {
		let component: T = this._models[name];
		return component;
	}

	/**
	 * Gets a Controller.
	 *
	 * @method controller
	 * @template T
	 * @param {string} name
	 * @returns {T}
	 *
	 * @memberOf Facile
	 */
	controller&lt;T>(name: string): T {
		let component: T = this._controllers[name];
		return component;
	}

	/**
	 * Convenience wrapper for lodash extend.
	 *
	 * @method extend
	 * @param {...any[]} args
	 * @returns {*}
	 *
	 * @memberOf Facile
	 */
	extend(...args: any[]): any {
		return _extend.apply(null, args);
	}

}
</pre>
        </article>
    </section>





				</div>

				<div class="clearfix"></div>
				<footer>
					
					The barebones framework!
					<br />
					
					
						<span class="copyright">
						Facile Copyright © 2016 Origin1 Technologies.
						</span>
									<br />
									
						<span class="jsdoc-message">
						Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
						on Fri Oct 14 2016 07:39:42 GMT-0700 (PDT) using the <a href="https://github.com/xperiments/TSDoc">TSDoc template</a>.
						</span>
				</footer>
			</div>
			<!--
			
			-->
			<br clear="both">
		</div>

	</div>

	<script src="scripts/sunlight.js"></script>
	<script src="scripts/sunlight.javascript.js"></script>
	<script src="scripts/sunlight-plugin.doclinks.js"></script>
	<script src="scripts/sunlight-plugin.linenumbers.js"></script>
	<script src="scripts/sunlight-plugin.menu.js"></script>
	<script src="scripts/jquery.min.js"></script>
	<script src="scripts/jquery.scrollTo.js"></script>
	<script src="scripts/jquery.localScroll.js"></script>
	<script src="scripts/bootstrap.min.js"></script>



	<script>  Sunlight.highlightAll({lineNumbers:false,  showMenu: true, enableDoclinks :true}); </script>

	<script>
		$( function () {

			var searchItems = [];
			var searchMap = {};
			var mapName = "";
			for( var i=0; i<searchMembers.length; i++ )
			{
				realName = searchMembers[i].realName;
				searchItems.push( realName );
				searchMap[ realName ] = searchMembers[ i ];
			}


			$('.typeahead').typeahead({
			  source: searchItems,
			  matcher: function(item) {
			  	//console.log('aaa'+item, this.query, item.indexOf( this.query.toLowerCase() )==-1?false:true)
                // evaluate item variable and return true if the item was matched.
                return item.toLowerCase().indexOf( this.query.toLowerCase() )==-1?false:true;
             },
			  updater: function (item) {
					window.location.href = searchMap[ item ].link+'.html';
			  }

			});


            // Move Tutorials to bottom
            //$('#menuContainer').append($('#navTitle_Tutorials'));
            //$('#menuContainer').append($('#navContents_Tutorials'));
			$(window).resize(function() {
			  $('#side-menu').height( $(window).height()-70 );
			  $('#sideMenuFrame').height( $(window).height()-140 );
			  if( $(window).width() <480 )
			  {
			  	$('#side-menu').hide();
				$('#docContents').removeClass('sideMenu');
			  }
			});

			$(window).trigger('resize')
			$('#btnCollapse').click(function()
			{
				$('#side-menu').toggle();
				$('#docContents').toggleClass('sideMenu');

			})
			$('#btnHome').click(function()
			{
				document.location.href="index.html"

			})		

			$('.sourceBar').click(function(){})
			var lastMenuSelection = window.localStorage.getItem('lastMenuSelection') || null;
			if( lastMenuSelection ) $('a[data-id='+lastMenuSelection+']').click();
			$('a[data-toggle=collapse]').click(function(){
				if( lastMenuSelection == $(this).attr('data-id') ) return;
				if( lastMenuSelection ) $('a[data-id='+lastMenuSelection+']').click();
				lastMenuSelection = $(this).attr('data-id');
				window.localStorage.setItem('lastMenuSelection', lastMenuSelection )
			});	


		} );
	</script>

	
	<script>
		$( function () {
			$('#main').localScroll({
				offset: { top: 56 } //offset by the height of your header (give or take a few px, see what works for you)
			});
			$(".routeTitle").on('click', function(){
			    $(this).next().slideToggle();
			});
			$( "dt h4.name" ).each( function () {
				var $this = $( this );
				//var icon = $( "<i/>" ).addClass( "icon-plus-sign" ).addClass( "pull-right" );
				var dt = $this.parents( "dt" );
				var children = dt.next( "dd" );

				//$this.append( icon ).css( {cursor : "pointer"} );
				$this.addClass( "member-collapsed" ).addClass( "member" );

				children.hide();
				$this.toggle( function () {
					//icon.addClass( "icon-minus-sign" ).removeClass( "icon-plus-sign" );
					$this.addClass( "member-open" ).removeClass( "member-collapsed" );
					children.slideDown();
				}, function () {
					//icon.addClass( "icon-plus-sign" ).removeClass( "icon-minus-sign" );
					$this.addClass( "member-collapsed" ).removeClass( "member-open" );
					children.slideUp();
				} );
			} );
			$('.sourceBar').click(function(event){event.stopPropagation();})
		} );
	</script>
	

</body>
</html>
